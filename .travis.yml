language: php

php:
  - 5.5
  - 5.6
  - hhvm

addons:
  hosts:
    - system.hyn.me
    - tenant.hyn.me

install:
  # create a new database for the hyn connection
  - mysql -e 'create database hyn;' -uroot
  - mysql -e "grant all privileges on *.* to 'travis'@'localhost' with grant option;" -uroot
  # set the global github token, so connections won't be cancelled
  - composer config -g github-oauth.github.com $GITHUB_TOKEN
  # create a new laravel project in the subfolder laravel (default composer behaviour)
  - mkdir tmp
  - cp -r * tmp/
  - composer create-project laravel/laravel
  # move into the laravel directory
  - cd ./laravel
  # require the package for inclusion in the project
  - composer require hyn-me/framework "dev-master as 0.1.9"
  - composer require hyn-me/multi-tenant dev-$TRAVIS_BRANCH
  - mkdir vendor/hyn-me/multi-tenant
  - cp -r ../tmp/* vendor/hyn-me/multi-tenant
  # set environment globals for connection mysql
  - export DB_USERNAME=travis DB_DATABASE=hyn DB_PASSWORD=


before_script:
  # moves the package phpunit config to root
  - cp ./vendor/hyn-me/multi-tenant/phpunit.travis.xml ./phpunit.xml

script:
  - phpunit